import{_ as X,d as Y,c as l,o as r,a as e,n as ee,b as G,g as te,e as H,i as se,F as O,j as Z,t as u,x as V,A as ae,h as D,M as v,l as x,m as K,r as S,u as _,f as T,s as $,I as ne,B as oe,C as ie,k as re,z as le}from"./index-Bf276Rcj.js";import{A as de,f as B,R as ce,i as ue,j as me,d as fe,_ as pe,e as ge,k as ye,g as ve,l as _e,h as xe,m as we}from"./UserSelector-C9WRG5wN.js";const he=Y({name:"IconDownload",props:{size:{type:[Number,String]},strokeWidth:{type:Number,default:4},strokeLinecap:{type:String,default:"butt",validator:a=>["butt","round","square"].includes(a)},strokeLinejoin:{type:String,default:"miter",validator:a=>["arcs","bevel","miter","miter-clip","round"].includes(a)},rotate:Number,spin:Boolean},emits:{click:a=>!0},setup(a,{emit:p}){const o=te("icon"),n=H(()=>[o,`${o}-download`,{[`${o}-spin`]:a.spin}]),m=H(()=>{const y={};return a.size&&(y.fontSize=se(a.size)?`${a.size}px`:a.size),a.rotate&&(y.transform=`rotate(${a.rotate}deg)`),y});return{cls:n,innerStyle:m,onClick:y=>{p("click",y)}}}}),be=["stroke-width","stroke-linecap","stroke-linejoin"];function ke(a,p,o,n,m,g){return r(),l("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:G(a.cls),style:ee(a.innerStyle),"stroke-width":a.strokeWidth,"stroke-linecap":a.strokeLinecap,"stroke-linejoin":a.strokeLinejoin,onClick:p[0]||(p[0]=(...y)=>a.onClick&&a.onClick(...y))},p[1]||(p[1]=[e("path",{d:"m33.072 22.071-9.07 9.071-9.072-9.07M24 5v26m16 4v6H8v-6"},null,-1)]),14,be)}var J=X(he,[["render",ke]]);const $e=Object.assign(J,{install:(a,p)=>{var o;const n=(o=p==null?void 0:p.iconPrefix)!=null?o:"";a.component(n+J.name,J)}});async function Ce(a,p={}){if(!a)throw new Error("urn is required");const{useCurrentToken:o=!0,token:n=null}=p;try{const m=`${de}/api/forge-viewer/url`,g=await fetch(m,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({urn:a,use_current_token:o,token:n})});if(!g.ok)throw new Error(`HTTP Error: ${g.status} ${g.statusText}`);const y=await g.json();if(!y.success)throw new Error(y.error||"Failed to generate viewer URL");return y}catch(m){throw console.error("Failed to generate viewer URL:",m),m}}const Re={class:"overflow-hidden"},De={key:0,class:"flex justify-center items-center py-12"},je={key:1,class:"text-center py-12 text-gray-500"},Ue={key:2,class:"overflow-x-auto"},Le={class:"w-full"},Te={class:"bg-white divide-y divide-gray-200"},Ae=["onClick"],Fe={class:"px-4 py-4"},Se={class:"flex items-center gap-3"},Ve={class:"text-sm text-gray-900 truncate"},Ie={class:"px-4 py-4"},Ne={key:0,class:"text-sm text-gray-600"},Be={key:1,class:"text-sm text-gray-400"},ze={class:"px-4 py-4"},Me={class:"text-sm text-gray-600"},Ee={class:"px-4 py-4"},Pe={class:"text-sm text-gray-600"},Oe={class:"px-4 py-4"},Ze={class:"flex justify-center"},Ge=["onClick","title"],He={__name:"DocumentTable",props:{documents:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},setup(a){const p=async o=>{var m;const n=(o==null?void 0:o.urn)||(o==null?void 0:o.URN);if(!n){console.warn("Document does not have URN, cannot open viewer:",o),v.warning("此文档无法预览（缺少 URN）");return}try{console.log("Generating viewer URL for document:",{fileName:o.display_name,urn:n,version:o.version_number});const g=await Ce(n,{useCurrentToken:!0});if(g.success&&((m=g.data)!=null&&m.viewer_url)){const y=g.data.viewer_url;window.open(y,"_blank","noopener,noreferrer"),console.log("Viewer URL generated successfully:",{urn:n,viewerUrl:y,fileName:o.display_name})}else throw new Error("Failed to generate viewer URL")}catch(g){console.error("Failed to open Forge Viewer:",g),v.error(`无法打开预览: ${g.message||"未知错误"}`)}};return(o,n)=>(r(),l("div",Re,[a.loading?(r(),l("div",De,[...n[0]||(n[0]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1)])])):a.documents.length?(r(),l("div",Ue,[e("table",Le,[n[3]||(n[3]=e("thead",{class:"bg-gray-50 border-b border-gray-200"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," File Name "),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-24"}," Version "),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-44"}," Last Modified "),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-44"}," Last Modified User "),e("th",{class:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-28"}," Action ")])],-1)),e("tbody",Te,[(r(!0),l(O,null,Z(a.documents,m=>(r(),l("tr",{key:m.id,class:"hover:bg-gray-50 transition-colors cursor-pointer",onClick:g=>p(m)},[e("td",Fe,[e("div",Se,[n[1]||(n[1]=e("svg",{class:"w-5 h-5 text-gray-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})],-1)),e("span",Ve,u(m.display_name),1)])]),e("td",Ie,[m.version_number?(r(),l("span",Ne," v"+u(m.version_number),1)):(r(),l("span",Be,"-"))]),e("td",ze,[e("span",Me,u(m.last_modified_time?V(B)(m.last_modified_time):"-"),1)]),e("td",Ee,[e("span",Pe,u(m.last_modified_user_name||"-"),1)]),e("td",Oe,[e("div",Ze,[e("button",{onClick:ae(g=>o.$emit("download-document",m),["stop"]),class:"inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium text-blue-600 bg-blue-50 rounded-md hover:bg-blue-100 transition-colors",title:`Download ${m.display_name}`},[...n[2]||(n[2]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1),D(" Download ",-1)])],8,Ge)])])],8,Ae))),128))])])])):(r(),l("div",je," No documents found "))]))}},We={class:"overflow-hidden"},qe={class:"mb-4 flex justify-between items-center"},Je={class:"flex items-center gap-2"},Ke={key:0},Qe={key:0,class:"flex justify-center items-center py-12"},Xe={key:1,class:"text-center py-12 text-gray-500"},Ye={key:2,class:"space-y-4"},et={class:"px-4 py-3 bg-gray-50 border-b border-gray-200 flex justify-between items-center"},tt={class:"font-medium text-gray-700"},st={class:"text-sm text-gray-500"},at={class:"p-3 space-y-3"},nt={class:"flex items-start justify-between mb-2"},ot={class:"flex items-center gap-3 flex-1 min-w-0"},it={class:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white font-medium text-sm flex-shrink-0"},rt={class:"flex-1 min-w-0"},lt={class:"font-medium text-gray-900 truncate"},dt={class:"text-sm text-gray-500 truncate"},ct={class:"flex items-start justify-between text-sm mt-3 pt-3 border-t border-gray-100"},ut={class:"text-gray-600 space-y-1"},mt={key:0,class:"flex items-center gap-1"},ft={class:"text-gray-700"},pt={key:1,class:"flex items-start gap-1"},gt={class:"text-gray-700"},yt={class:"text-right flex-shrink-0"},vt={class:"text-gray-700 font-medium"},_t={class:"text-xs text-gray-400 mt-0.5"},xt={key:3,class:"space-y-3"},wt={class:"flex items-start justify-between mb-2"},ht={class:"flex items-center gap-3 flex-1 min-w-0"},bt={class:"w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center text-white font-medium text-sm flex-shrink-0"},kt={class:"flex-1 min-w-0"},$t={class:"font-medium text-gray-900 truncate"},Ct={class:"text-sm text-gray-500 truncate"},Rt={class:"flex items-start justify-between text-sm mt-3 pt-3 border-t border-gray-100"},Dt={class:"text-gray-600 space-y-1"},jt={key:0,class:"flex items-center gap-1"},Ut={class:"text-gray-700"},Lt={key:1,class:"flex items-start gap-1"},Tt={class:"text-gray-700"},At={class:"text-right flex-shrink-0"},Ft={class:"text-gray-700 font-medium"},St={class:"text-xs text-gray-400 mt-0.5"},Vt={class:"mt-4 flex justify-end gap-2"},It={__name:"RecipientList",props:{recipients:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},transmittalCreatedAt:{type:String,default:null},transmittalId:{type:String,default:null},currentUserEmail:{type:String,default:null}},emits:["recipients-added"],setup(a,{emit:p}){const o=a,n=p,m=H(()=>!o.currentUserEmail||!o.recipients.length?!1:o.recipients.some(t=>t.email.toLowerCase()===o.currentUserEmail.toLowerCase())),g=x([]),y=x([]),C=x(!1),R=x(!1),h=x([]),j=x(!1),b=x("none"),k=H(()=>{if(b.value==="none")return[];if(b.value==="status"){const t={Downloaded:[],Viewed:[],Received:[]};for(const s of o.recipients){const d=I(s);t[d].push(s)}return Object.entries(t).filter(([s,d])=>d.length>0).map(([s,d])=>({name:s,recipients:d}))}if(b.value==="company"){const t={};for(const s of o.recipients){const d=U(s),c=d?d.name:"No Company";t[c]||(t[c]=[]),t[c].push(s)}return Object.entries(t).sort(([s],[d])=>s==="No Company"?1:d==="No Company"?-1:s.localeCompare(d)).map(([s,d])=>({name:s,recipients:d}))}return[]});async function W(){try{const t=await ue({page_size:100});t.status==="success"&&t.data&&(g.value=t.data.companies||[])}catch(t){console.error("Failed to load companies:",t)}}async function z(){try{const t=await me({page_size:100});t.status==="success"&&t.data&&(y.value=t.data.roles||[])}catch(t){console.error("Failed to load roles:",t)}}function U(t){return g.value.find(s=>{var d;return(d=s.users)==null?void 0:d.some(c=>c.email===t.email)})}function A(t){return y.value.filter(s=>{var d;return(d=s.users)==null?void 0:d.some(c=>c.email===t.email)})}function M(){R.value=!1,h.value=[]}async function q(){if(!o.transmittalId||h.value.length===0)return;const t=new Set(o.recipients.map(c=>c.email.toLowerCase())),s=[],d=[];for(const c of h.value)t.has(c.email.toLowerCase())?d.push(c.name||c.email):s.push({user_id:c.user_id,user_name:c.name,email:c.email,company_name:c.company_name});if(d.length>0&&v.warning(`The following recipients already exist: ${d.join(", ")}`),s.length===0){v.info("All selected recipients already exist in this transmittal");return}try{j.value=!0;const c=await fe(o.transmittalId,{recipients:s});c.success?(v.success(`Successfully added ${c.recipients_added} recipient(s)`),R.value=!1,h.value=[],n("recipients-added")):v.error(c.error||"Failed to add recipients")}catch(c){console.error("Failed to add recipients:",c),v.error("Failed to add recipients: "+c.message)}finally{j.value=!1}}K(async()=>{C.value=!0;try{await Promise.all([W(),z()])}finally{C.value=!1}});function E(t){if(!t)return"?";const s=t.trim().split(" ");return s.length>=2?(s[0][0]+s[s.length-1][0]).toUpperCase():t.substring(0,2).toUpperCase()}function I(t){return t.downloaded_at?"Downloaded":t.viewed_at?"Viewed":"Received"}function L(t){return t.downloaded_at?"bg-green-100 text-green-700":t.viewed_at?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-600"}function P(t){return t.downloaded_at?B(t.downloaded_at):t.viewed_at?B(t.viewed_at):o.transmittalCreatedAt?B(o.transmittalCreatedAt):"-"}function i(t){return t.downloaded_at?"Downloaded":t.viewed_at?"Viewed":"Received"}return(t,s)=>{const d=S("a-option"),c=S("a-select"),N=S("a-button"),F=S("a-modal");return r(),l("div",We,[e("div",qe,[e("div",Je,[s[7]||(s[7]=e("span",{class:"text-sm text-gray-500"},"Group by:",-1)),_(c,{modelValue:b.value,"onUpdate:modelValue":s[0]||(s[0]=f=>b.value=f),size:"small",style:{width:"120px"}},{default:$(()=>[_(d,{value:"none"},{default:$(()=>[...s[4]||(s[4]=[D("None",-1)])]),_:1}),_(d,{value:"company"},{default:$(()=>[...s[5]||(s[5]=[D("Company",-1)])]),_:1}),_(d,{value:"status"},{default:$(()=>[...s[6]||(s[6]=[D("Status",-1)])]),_:1})]),_:1},8,["modelValue"])]),a.transmittalId&&m.value?(r(),l("div",Ke,[_(N,{type:"primary",onClick:s[1]||(s[1]=f=>R.value=!0)},{icon:$(()=>[_(V(ne))]),default:$(()=>[s[8]||(s[8]=D(" Add Recipients ",-1))]),_:1})])):T("",!0)]),a.loading?(r(),l("div",Qe,[...s[9]||(s[9]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"},null,-1)])])):a.recipients.length?b.value!=="none"?(r(),l("div",Ye,[(r(!0),l(O,null,Z(k.value,f=>(r(),l("div",{key:f.name,class:"border border-gray-200 rounded-lg overflow-hidden"},[e("div",et,[e("span",tt,u(f.name),1),e("span",st,u(f.recipients.length)+" recipient(s)",1)]),e("div",at,[(r(!0),l(O,null,Z(f.recipients,w=>(r(),l("div",{key:w.email,class:"p-4 rounded-lg border border-gray-200 hover:border-blue-300 hover:bg-blue-50/30 transition-all"},[e("div",nt,[e("div",ot,[e("div",it,u(E(w.name)),1),e("div",rt,[e("div",lt,u(w.name||"Unknown"),1),e("div",dt,u(w.email),1)])]),e("span",{class:G([L(w),"px-2.5 py-1 rounded-full text-xs font-medium whitespace-nowrap ml-2"])},u(I(w)),3)]),e("div",ct,[e("div",ut,[U(w)?(r(),l("div",mt,[s[10]||(s[10]=e("span",{class:"text-gray-400 text-xs"},"Company:",-1)),e("span",ft,u(U(w).name),1)])):T("",!0),A(w).length>0?(r(),l("div",pt,[s[11]||(s[11]=e("span",{class:"text-gray-400 text-xs"},"Role:",-1)),e("span",gt,u(A(w).map(Q=>Q.name).join(", ")),1)])):T("",!0)]),e("div",yt,[e("div",vt,u(P(w)),1),e("div",_t,u(i(w)),1)])])]))),128))])]))),128))])):(r(),l("div",xt,[(r(!0),l(O,null,Z(a.recipients,f=>(r(),l("div",{key:f.email,class:"p-4 rounded-lg border border-gray-200 hover:border-blue-300 hover:bg-blue-50/30 transition-all"},[e("div",wt,[e("div",ht,[e("div",bt,u(E(f.name)),1),e("div",kt,[e("div",$t,u(f.name||"Unknown"),1),e("div",Ct,u(f.email),1)])]),e("span",{class:G([L(f),"px-2.5 py-1 rounded-full text-xs font-medium whitespace-nowrap ml-2"])},u(I(f)),3)]),e("div",Rt,[e("div",Dt,[U(f)?(r(),l("div",jt,[s[12]||(s[12]=e("span",{class:"text-gray-400 text-xs"},"Company:",-1)),e("span",Ut,u(U(f).name),1)])):T("",!0),A(f).length>0?(r(),l("div",Lt,[s[13]||(s[13]=e("span",{class:"text-gray-400 text-xs"},"Role:",-1)),e("span",Tt,u(A(f).map(w=>w.name).join(", ")),1)])):T("",!0)]),e("div",At,[e("div",Ft,u(P(f)),1),e("div",St,u(i(f)),1)])])]))),128))])):(r(),l("div",Xe," No recipients found ")),_(F,{visible:R.value,"onUpdate:visible":s[3]||(s[3]=f=>R.value=f),title:"Add Recipients",width:600,footer:!1,onCancel:M},{default:$(()=>[_(ce,{modelValue:h.value,"onUpdate:modelValue":s[2]||(s[2]=f=>h.value=f)},null,8,["modelValue"]),e("div",Vt,[_(N,{onClick:M},{default:$(()=>[...s[14]||(s[14]=[D("Cancel",-1)])]),_:1}),_(N,{type:"primary",loading:j.value,disabled:h.value.length===0,onClick:q},{default:$(()=>[D(" Add "+u(h.value.length)+" Recipient(s) ",1)]),_:1},8,["loading","disabled"])])]),_:1},8,["visible"])])}}},Nt={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-shadow"},Bt={class:"p-4"},zt={class:"grid grid-cols-3 gap-4"},Mt={class:"border border-gray-200 rounded-md p-3 bg-gray-50/50"},Et={class:"text-sm text-gray-900 font-medium"},Pt={class:"border border-gray-200 rounded-md p-3 bg-gray-50/50"},Ot={key:1,class:"text-sm text-gray-400"},Zt={class:"border border-gray-200 rounded-md p-3 bg-gray-50/50"},Gt={class:"text-sm text-gray-900 font-medium"},Ht={class:"border border-gray-200 rounded-md p-3 bg-gray-50/50"},Wt={class:"text-sm text-gray-900 font-medium"},qt={class:"col-span-2 border border-gray-200 rounded-md p-3 bg-gray-50/50"},Jt={key:0},Kt={class:"text-sm text-gray-900 font-medium"},Qt={key:0,class:"text-xs text-gray-500 mt-0.5"},Xt={key:1,class:"text-sm text-gray-400"},Yt={class:"border border-gray-200 rounded-md p-3 bg-gray-50/50"},es={class:"text-sm text-gray-900"},ts={__name:"TransmittalInfoCard",props:{transmittal:{type:Object,default:()=>({})}},setup(a){function p(o){switch(o.toLowerCase()){case"sent":return"bg-green-100 text-green-700 border border-green-200";case"draft":return"bg-gray-100 text-gray-700 border border-gray-200";case"pending":return"bg-yellow-100 text-yellow-700 border border-yellow-200";default:return"bg-blue-100 text-blue-700 border border-blue-200"}}return(o,n)=>(r(),l("div",Nt,[n[6]||(n[6]=e("div",{class:"px-6 py-3 border-b border-gray-200 bg-gray-50"},[e("h2",{class:"text-base font-semibold text-gray-900"},"General Information")],-1)),e("div",Bt,[e("div",zt,[e("div",Mt,[n[0]||(n[0]=e("div",{class:"text-xs font-medium text-gray-500 mb-1"}," Title ",-1)),e("div",Et,u(a.transmittal.subject||"-"),1)]),e("div",Pt,[n[1]||(n[1]=e("div",{class:"text-xs font-medium text-gray-500 mb-1"}," Status ",-1)),e("div",null,[a.transmittal.status?(r(),l("span",{key:0,class:G([p(a.transmittal.status),"inline-flex px-2.5 py-0.5 rounded-full text-xs font-medium"])},u(a.transmittal.status),3)):(r(),l("span",Ot,"-"))])]),e("div",Zt,[n[2]||(n[2]=e("div",{class:"text-xs font-medium text-gray-500 mb-1"}," Document Count ",-1)),e("div",Gt,u(a.transmittal.document_count||0),1)]),e("div",Ht,[n[3]||(n[3]=e("div",{class:"text-xs font-medium text-gray-500 mb-1"}," Recipient Count ",-1)),e("div",Wt,u(a.transmittal.recipient_count||0),1)]),e("div",qt,[n[4]||(n[4]=e("div",{class:"text-xs font-medium text-gray-500 mb-1"}," Created By ",-1)),a.transmittal.created_by_name?(r(),l("div",Jt,[e("div",Kt,u(a.transmittal.created_by_name),1),a.transmittal.created_by_email?(r(),l("div",Qt,u(a.transmittal.created_by_email),1)):T("",!0)])):(r(),l("div",Xt,"-"))]),e("div",Yt,[n[5]||(n[5]=e("div",{class:"text-xs font-medium text-gray-500 mb-1"}," Created At ",-1)),e("div",es,u(a.transmittal.created_at?V(B)(a.transmittal.created_at):"-"),1)])])])]))}};function ss(a,p){const o=window.URL.createObjectURL(a),n=document.createElement("a");n.style.display="none",n.href=o,n.download=p,document.body.appendChild(n),n.click(),window.URL.revokeObjectURL(o),document.body.removeChild(n)}function as(a){if(a===0)return"0 Bytes";const p=1024,o=["Bytes","KB","MB","GB"],n=Math.floor(Math.log(a)/Math.log(p));return Math.round(a/Math.pow(p,n)*100)/100+" "+o[n]}const ns={class:"page-container"},os={class:"page-header"},is={class:"flex items-center gap-4"},rs={class:"page-title"},ls={class:"flex gap-3 items-center"},ds={key:0,class:"loading-container"},cs={key:1,class:"space-y-6"},us={class:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden"},ms={class:"flex h-full divide-x divide-gray-200"},fs={class:"flex-1"},ps={class:"px-6 py-4 border-b border-gray-200 flex justify-between items-center bg-gray-50"},gs=["disabled"],ys={key:1},vs={key:2},_s={class:"p-6"},xs={class:"w-[500px]"},ws={class:"px-6 py-4 border-b border-gray-200 flex justify-between items-center bg-gray-50"},hs={class:"text-sm text-gray-500"},bs={class:"p-6"},ks={__name:"TransmittalDetail",setup(a){const p=le(),o=oe(),n=x(""),m=x({autodeskId:"",name:"",email:""}),g=x({}),y=x([]),C=x([]),R=x(!0),h=x(!1),j=x(!1),b=x(!1),k=o.params.id;function W(i){m.value=i,i.email&&z(i.email)&&A(i.email),L()}function z(i){return!i||!C.value.length?!1:C.value.some(t=>t.email&&t.email.toLowerCase()===i.toLowerCase())}function U(){p.push({name:"TransmittalList"})}async function A(i){try{await we(k,i)}catch(t){console.error("Failed to mark as viewed:",t)}}async function M(){if(!y.value.length){v.warning("No documents to download");return}const i=m.value.email;console.log("[Download] Current user email:",i),console.log("[Download] Is recipient:",z(i)),console.log("[Download] Transmittal ID:",k),console.log("[Download] Current recipients:",C.value),b.value=!0;try{const t=await ye(k,i||null),{fileCount:s,totalSize:d,failedFiles:c}=t.metadata||{},N=`transmittal_${g.value.transmittal_number||k}.zip`;ss(t,N);let F=`Downloaded ${s||y.value.length} files`;d&&(F+=` (${as(d)})`),c&&c.length>0?(F+=`
${c.length} file(s) failed to download`,v.warning(F)):v.success(F),console.log("[Download] Waiting before reload..."),await new Promise(f=>setTimeout(f,2e3)),console.log("[Download] Reloading recipients..."),await L(),console.log("[Download] Recipients after reload:",C.value)}catch(t){console.error("Failed to download ZIP:",t),v.error(t.message||"Failed to download ZIP file")}finally{b.value=!1}}async function q(i){try{v.info(`Downloading ${i.display_name}...`);const t=`http://localhost:8080/api/transmittals/${k}/documents/${i.id}/download`,s=document.createElement("a");s.href=t,s.download=i.display_name,s.target="_blank",document.body.appendChild(s),s.click(),document.body.removeChild(s),v.success(`Download started for ${i.display_name}`)}catch(t){console.error("Failed to download document:",t),v.error(`Failed to download ${i.display_name}`)}}async function E(){try{const i=await ve();if(i.success&&i.data){const t=i.data.find(s=>s.id===k);t?g.value=t:(v.error("Transmittal not found"),p.push({name:"TransmittalList"}))}}catch(i){console.error("Failed to load transmittal:",i),v.error("Failed to load transmittal details")}}async function I(){h.value=!0;try{const i=await _e(k);i.success&&i.data&&(y.value=i.data)}catch(i){console.error("Failed to load documents:",i),v.error("Failed to load documents")}finally{h.value=!1}}async function L(){j.value=!0;try{const i=await xe(k);i.success&&i.data&&(C.value=i.data)}catch(i){console.error("Failed to load recipients:",i),v.error("Failed to load recipients")}finally{j.value=!1}}async function P(){R.value=!0;try{await Promise.all([E(),I(),L()])}finally{R.value=!1}}return K(()=>{P()}),(i,t)=>{const s=S("a-button"),d=S("a-spin");return r(),l("div",ns,[e("div",os,[e("div",is,[_(s,{onClick:U},{icon:$(()=>[_(V(ie))]),default:$(()=>[t[1]||(t[1]=D(" Back ",-1))]),_:1}),e("div",null,[e("h1",rs,u(g.value.subject||"Transmittal Details"),1)])]),e("div",ls,[_(ge,{modelValue:n.value,"onUpdate:modelValue":t[0]||(t[0]=c=>n.value=c),onUserChanged:W},null,8,["modelValue"])])]),R.value?(r(),l("div",ds,[_(d,{size:"large"})])):(r(),l("div",cs,[_(ts,{transmittal:g.value},null,8,["transmittal"]),e("div",us,[e("div",ms,[e("div",fs,[e("div",ps,[t[2]||(t[2]=e("h2",{class:"text-lg font-semibold text-gray-900"},"Documents",-1)),e("button",{disabled:!y.value.length||b.value,onClick:M,class:"inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"},[b.value?T("",!0):(r(),re(V($e),{key:0,class:"w-4 h-4"})),b.value?(r(),l("span",ys,"Downloading...")):(r(),l("span",vs,"Download All as ZIP"))],8,gs)]),e("div",_s,[_(He,{documents:y.value,loading:h.value,onDownloadDocument:q},null,8,["documents","loading"])])]),e("div",xs,[e("div",ws,[t[3]||(t[3]=e("h2",{class:"text-lg font-semibold text-gray-900"},"Recipients",-1)),e("span",hs,u(C.value.length)+" recipient(s) ",1)]),e("div",bs,[_(It,{recipients:C.value,loading:j.value,"transmittal-created-at":g.value.created_at,"transmittal-id":V(k),"current-user-email":m.value.email,onRecipientsAdded:L},null,8,["recipients","loading","transmittal-created-at","transmittal-id","current-user-email"])])])])])]))])}}},Rs=pe(ks,[["__scopeId","data-v-bfea2a0f"]]);export{Rs as default};
