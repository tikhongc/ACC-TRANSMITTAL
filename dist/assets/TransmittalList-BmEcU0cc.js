import{_ as K,d as Q,c as p,o as d,a as n,n as B,b as j,g as X,e as F,i as Y,r as T,f as V,t as C,h as $,F as N,j as D,k as M,l as S,w as q,m as O,p as Z,v as ee,M as L,q as W,s as x,u as y,x as E,y as te,I as le,z as se}from"./index-Bf276Rcj.js";import{a as ne,A as ae,P as G,_ as R,R as re,c as oe,b as ie,d as de,f as ue,e as ce,g as me,h as fe}from"./UserSelector-C9WRG5wN.js";const pe=Q({name:"IconRefresh",props:{size:{type:[Number,String]},strokeWidth:{type:Number,default:4},strokeLinecap:{type:String,default:"butt",validator:l=>["butt","round","square"].includes(l)},strokeLinejoin:{type:String,default:"miter",validator:l=>["arcs","bevel","miter","miter-clip","round"].includes(l)},rotate:Number,spin:Boolean},emits:{click:l=>!0},setup(l,{emit:_}){const i=X("icon"),w=F(()=>[i,`${i}-refresh`,{[`${i}-spin`]:l.spin}]),v=F(()=>{const m={};return l.size&&(m.fontSize=Y(l.size)?`${l.size}px`:l.size),l.rotate&&(m.transform=`rotate(${l.rotate}deg)`),m});return{cls:w,innerStyle:v,onClick:m=>{_("click",m)}}}}),ve=["stroke-width","stroke-linecap","stroke-linejoin"];function ge(l,_,i,w,v,h){return d(),p("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:j(l.cls),style:B(l.innerStyle),"stroke-width":l.strokeWidth,"stroke-linecap":l.strokeLinecap,"stroke-linejoin":l.strokeLinejoin,onClick:_[0]||(_[0]=(...m)=>l.onClick&&l.onClick(...m))},_[1]||(_[1]=[n("path",{d:"M38.837 18C36.463 12.136 30.715 8 24 8 15.163 8 8 15.163 8 24s7.163 16 16 16c7.455 0 13.72-5.1 15.496-12M40 8v10H30"},null,-1)]),14,ve)}var P=K(pe,[["render",ge]]);const _e=Object.assign(P,{install:(l,_)=>{var i;const w=(i=_==null?void 0:_.iconPrefix)!=null?i:"";l.component(w+P.name,P)}});async function he(){const l=`${ae}/api/file-tree?project_id=${G}`;return await ne(l)}const ye={class:"tree-node"},xe={class:"w-5 h-5 mr-1 flex items-center justify-center flex-shrink-0"},be={class:"mr-2 flex-shrink-0"},we={key:0,d:"M2 6a2 2 0 012-2h5l2 2h5a2 2 0 012 2v6a2 2 0 01-2 2H4a2 2 0 01-2-2V6z"},ke={key:1,"fill-rule":"evenodd",d:"M2 6a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1H8a3 3 0 00-3 3v1.5a1.5 1.5 0 01-3 0V6z","clip-rule":"evenodd"},Ce={class:"flex-1 min-w-0"},$e={class:"text-sm font-medium text-gray-700 truncate block"},Te={key:0,class:"ml-2 px-2 py-0.5 bg-gray-100 text-gray-600 text-xs rounded-full flex-shrink-0"},Se={class:"w-5 h-5 mr-1 flex items-center justify-center flex-shrink-0"},Fe={key:0,class:"w-3 h-3 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ve={class:"mr-2 flex-shrink-0"},ze={class:"flex-1 min-w-0"},Ae={class:"flex items-baseline gap-2"},Ie={class:"text-sm text-gray-700 truncate block"},je={key:0,class:"text-xs text-gray-400 uppercase flex-shrink-0"},Le={class:"ml-2 flex items-center gap-3 flex-shrink-0 text-xs text-gray-500"},Re={key:0,class:"flex items-center gap-1"},Me={key:1,class:"hidden sm:inline"},Ue={key:2,class:"folder-children"},Be={__name:"TreeNode",props:{node:{type:Object,required:!0},level:{type:Number,default:0},selectedFiles:{type:Set,required:!0},expandedFolders:{type:Set,required:!0}},emits:["toggle-folder","select-file"],setup(l,{emit:_}){const i=l,w=_,v=F(()=>i.node.type==="folder"&&i.expandedFolders.has(i.node.id)),h=F(()=>i.node.type==="file"&&i.selectedFiles.has(i.node.urn)),m=F(()=>i.node.children&&i.node.children.length>0),k=F(()=>{if(i.node.type!=="folder")return 0;function o(f){let c=0;if(f.children)for(const t of f.children)t.type==="file"?c++:t.type==="folder"&&(c+=o(t));return c}return o(i.node)});function r(){w("toggle-folder",i.node.id)}function b(){w("select-file",{urn:i.node.urn,name:i.node.name,file_type:i.node.file_type,version_number:i.node.version_number})}function A(o){return{pdf:"text-red-500",doc:"text-blue-600",docx:"text-blue-600",xls:"text-green-600",xlsx:"text-green-600",ppt:"text-orange-500",pptx:"text-orange-500",dwg:"text-purple-500",rvt:"text-indigo-600",ifc:"text-cyan-600",jpg:"text-pink-500",jpeg:"text-pink-500",png:"text-pink-500",gif:"text-pink-500",mp4:"text-purple-600",mp3:"text-yellow-600",txt:"text-gray-500",md:"text-gray-600",json:"text-yellow-500",xml:"text-orange-400",csv:"text-green-500"}[o==null?void 0:o.toLowerCase()]||"text-gray-400"}function z(o){if(!o||o===0)return"-";const f=["B","KB","MB","GB","TB"];let c=o,t=0;for(;c>=1024&&t<f.length-1;)c/=1024,t++;return`${c.toFixed(t===0?0:1)} ${f[t]}`}return(o,f)=>{const c=T("TreeNode",!0);return d(),p("div",ye,[l.node.type==="folder"?(d(),p("div",{key:0,class:"folder-node hover:bg-gray-50 transition-colors",style:B({paddingLeft:`${l.level*20+12}px`})},[n("div",{class:"flex items-center py-2 pr-3 cursor-pointer select-none",onClick:r},[n("div",xe,[m.value?(d(),p("svg",{key:0,class:j(["w-4 h-4 text-gray-600 transition-transform duration-200",{"rotate-90":v.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...f[2]||(f[2]=[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)])],2)):V("",!0)]),n("div",be,[(d(),p("svg",{class:j(["w-5 h-5",v.value?"text-blue-500":"text-gray-400"]),fill:"currentColor",viewBox:"0 0 20 20"},[v.value?(d(),p("path",we)):(d(),p("path",ke))],2))]),n("div",Ce,[n("span",$e,C(l.node.name),1)]),k.value>0?(d(),p("div",Te,C(k.value),1)):V("",!0)])],4)):l.node.type==="file"?(d(),p("div",{key:1,class:j(["file-node hover:bg-blue-50 transition-colors",{"bg-blue-50":h.value}]),style:B({paddingLeft:`${l.level*20+12}px`})},[n("div",{class:"flex items-center py-2 pr-3 cursor-pointer select-none",onClick:b},[n("div",Se,[n("div",{class:j(["w-4 h-4 border-2 rounded flex items-center justify-center transition-all",h.value?"bg-blue-500 border-blue-500":"border-gray-300 hover:border-blue-400"])},[h.value?(d(),p("svg",Fe,[...f[3]||(f[3]=[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"3",d:"M5 13l4 4L19 7"},null,-1)])])):V("",!0)],2)]),n("div",Ve,[(d(),p("svg",{class:j(["w-5 h-5",A(l.node.file_type)]),viewBox:"0 0 20 20"},[...f[4]||(f[4]=[n("path",{fill:"currentColor","fill-rule":"evenodd",d:"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z","clip-rule":"evenodd"},null,-1)])],2))]),n("div",ze,[n("div",Ae,[n("span",Ie,C(l.node.name),1),l.node.file_type?(d(),p("span",je,C(l.node.file_type),1)):V("",!0)])]),n("div",Le,[l.node.version_number?(d(),p("span",Re,[f[5]||(f[5]=n("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"})],-1)),$(" v"+C(l.node.version_number),1)])):V("",!0),l.node.size?(d(),p("span",Me,C(z(l.node.size)),1)):V("",!0)])])],6)):V("",!0),l.node.type==="folder"&&v.value&&m.value?(d(),p("div",Ue,[(d(!0),p(N,null,D(l.node.children,t=>(d(),M(c,{key:t.id,node:t,level:l.level+1,"selected-files":l.selectedFiles,"expanded-folders":l.expandedFolders,onToggleFolder:f[0]||(f[0]=a=>o.$emit("toggle-folder",a)),onSelectFile:f[1]||(f[1]=a=>o.$emit("select-file",a))},null,8,["node","level","selected-files","expanded-folders"]))),128))])):V("",!0)])}}},Ne=R(Be,[["__scopeId","data-v-53d39776"]]),De={class:"file-tree-container"},qe={class:"mb-4"},Ee={class:"relative"},Pe={class:"file-tree-content border border-gray-200 rounded-lg overflow-hidden"},He={key:0,class:"flex items-center justify-center py-12"},Oe={key:1,class:"p-4 text-red-600"},We={key:2,class:"max-h-[500px] overflow-y-auto"},Ge={class:"divide-y divide-gray-100"},Je={key:0,class:"p-8 text-center text-gray-500"},Ke={key:0,class:"mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg"},Qe={class:"flex items-center justify-between"},Xe={class:"flex items-center gap-2"},Ye={class:"text-sm font-medium text-blue-900"},Ze={key:0,class:"mt-2 space-y-1"},et={__name:"FileSelectionTable",props:{projectId:{type:String,required:!0},modelValue:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(l,{emit:_}){const i=l,w=_,v=S([]),h=S(!1),m=S(null),k=S(""),r=S(new Set),b=S(new Set);async function A(){try{h.value=!0,m.value=null;const e=await he();console.log("File tree response:",e);let s=null;if(e.data&&Array.isArray(e.data.root)||e.success&&e.data&&Array.isArray(e.data.root)?s=e.data.root:(Array.isArray(e.data)||e.success&&Array.isArray(e.data))&&(s=e.data),!Array.isArray(s))throw new Error("Invalid file tree data format");v.value=s,console.log("Loaded tree data:",v.value)}catch(e){m.value=`Failed to load files: ${e.message}`,L.error(m.value),console.error("Failed to load files:",e)}finally{h.value=!1}}const z=F(()=>{if(!k.value.trim())return v.value;const e=k.value.toLowerCase();function s(g){const u=g.name.toLowerCase().includes(e);if(g.type==="file")return u?g:null;const U=g.children?g.children.map(s).filter(Boolean):[];return u||U.length>0?{...g,children:U}:null}return v.value.map(s).filter(Boolean)});function o(e){r.value.has(e)?r.value.delete(e):r.value.add(e),r.value=new Set(r.value)}function f(e){b.value.has(e.urn)?b.value.delete(e.urn):b.value.add(e.urn),b.value=new Set(b.value),a()}function c(){b.value.clear(),b.value=new Set,a()}const t=F(()=>{const e=[];function s(g){for(const u of g)u.type==="file"&&b.value.has(u.urn)&&e.push({urn:u.urn,name:u.name,file_type:u.file_type,version_number:u.version_number||1,size:u.size}),u.children&&u.children.length>0&&s(u.children)}return s(v.value),e});function a(){const e=t.value.filter(s=>s.urn).map(s=>({file_urn:s.urn,file_name:s.name,version_number:s.version_number}));w("update:modelValue",e)}return q(()=>i.modelValue,e=>{e&&e.length>0?b.value=new Set(e.map(s=>s.file_urn)):b.value=new Set},{immediate:!0}),q(k,e=>{if(e.trim()){let s=function(g){for(const u of g)u.type==="folder"&&(r.value.add(u.id),u.children&&u.children.length>0&&s(u.children))};s(v.value),r.value=new Set(r.value)}}),O(()=>{A()}),(e,s)=>(d(),p("div",De,[n("div",qe,[n("div",Ee,[Z(n("input",{"onUpdate:modelValue":s[0]||(s[0]=g=>k.value=g),type:"text",placeholder:"Search files and folders...",class:"w-full px-4 py-2 pl-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"},null,512),[[ee,k.value]]),s[1]||(s[1]=n("svg",{class:"absolute left-3 top-2.5 w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1))])]),n("div",Pe,[h.value?(d(),p("div",He,[...s[2]||(s[2]=[n("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"},null,-1)])])):m.value?(d(),p("div",Oe,C(m.value),1)):(d(),p("div",We,[n("div",Ge,[(d(!0),p(N,null,D(z.value,g=>(d(),M(Ne,{key:g.id,node:g,level:0,"selected-files":b.value,"expanded-folders":r.value,onToggleFolder:o,onSelectFile:f},null,8,["node","selected-files","expanded-folders"]))),128))]),z.value.length===0?(d(),p("div",Je,[...s[3]||(s[3]=[n("svg",{class:"mx-auto h-12 w-12 text-gray-400 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"})],-1),n("p",null,"No files or folders found",-1)])])):V("",!0)]))]),t.value.length>0?(d(),p("div",Ke,[n("div",Qe,[n("div",Xe,[s[6]||(s[6]=n("svg",{class:"w-5 h-5 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),n("span",Ye,[s[4]||(s[4]=$(" Selected ",-1)),n("strong",null,C(t.value.length),1),s[5]||(s[5]=$(" file(s) ",-1))])]),n("button",{onClick:c,class:"text-sm text-blue-600 hover:text-blue-800 font-medium"}," Clear All ")]),t.value.length>0&&t.value.length<=5?(d(),p("div",Ze,[(d(!0),p(N,null,D(t.value,g=>(d(),p("div",{key:g.urn,class:"text-xs text-blue-800 flex items-center gap-1"},[s[7]||(s[7]=n("svg",{class:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20"},[n("path",{"fill-rule":"evenodd",d:"M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4z","clip-rule":"evenodd"})],-1)),$(" "+C(g.name),1)]))),128))])):V("",!0)])):V("",!0)]))}},tt=R(et,[["__scopeId","data-v-d96a3915"]]),lt={__name:"TransmittalCreateModal",props:{modelValue:{type:Boolean,default:!1},currentUser:{type:Object,default:()=>({userId:"",autodeskId:"",name:"",email:""})}},emits:["update:modelValue","created"],setup(l,{emit:_}){const i=l,w=_,v=S(!1),h=S(!1),m=S(null),k=G,r=W({title:"",message:"",recipients:[],files:[]}),b={title:[{required:!0,message:"Title is required"}]};function A(t,a){!r.recipients||r.recipients.length===0?a("At least one recipient is required"):a()}function z(t,a){!r.files||r.files.length===0?a("At least one file is required"):a()}q(()=>i.modelValue,t=>{v.value=t,t&&o()},{immediate:!0}),q(v,t=>{w("update:modelValue",t)});function o(){r.title="",r.message="",r.recipients=[],r.files=[],m.value&&m.value.clearValidate()}function f(){v.value=!1}async function c(){try{const t=await m.value.validate();if(t){console.log("Validation errors:",t);return}if(!r.recipients||r.recipients.length===0){L.error("Please select at least one recipient");return}if(!r.files||r.files.length===0){L.error("Please select at least one file");return}h.value=!0,console.log("Creating transmittal...",r);const a=await oe({project_id:k.replace("b.",""),title:r.title,message:r.message||null,created_by_user_id:i.currentUser.userId||null,created_by_user_name:i.currentUser.name||"System User",created_by_company_id:null,created_by_company_name:null});if(!a.success)throw new Error(a.error||"Failed to create transmittal");const e=a.transmittal_id;console.log("Transmittal created:",e);const s=await ie(e,{documents:r.files.map(u=>({urn:u.file_urn,file_name:u.file_name,version_number:u.version_number||1}))});s.success||console.warn("Warning: Failed to add documents:",s.error);const g=await de(e,{recipients:r.recipients.map(u=>({user_id:u.user_id,user_name:u.name,email:u.email,company_name:u.company_name||null}))});g.success||console.warn("Warning: Failed to add recipients:",g.error),L.success("Transmittal created successfully"),v.value=!1,w("created",e)}catch(t){L.error("Failed to create transmittal: "+t.message),console.error("Failed to create transmittal:",t)}finally{h.value=!1}}return(t,a)=>{const e=T("a-button"),s=T("a-input"),g=T("a-form-item"),u=T("a-textarea"),U=T("a-form"),J=T("a-modal");return d(),M(J,{visible:v.value,"onUpdate:visible":a[4]||(a[4]=I=>v.value=I),title:"Create Transmittal",width:800,"mask-closable":!1,onCancel:f,onOk:c},{footer:x(()=>[y(e,{onClick:f},{default:x(()=>[...a[5]||(a[5]=[$("Cancel",-1)])]),_:1}),y(e,{type:"primary",loading:h.value,onClick:c},{default:x(()=>[...a[6]||(a[6]=[$(" Create Transmittal ",-1)])]),_:1},8,["loading"])]),default:x(()=>[y(U,{ref_key:"formRef",ref:m,model:r,rules:b,layout:"vertical"},{default:x(()=>[y(g,{field:"title",label:"Title",rules:[{required:!0,message:"Title is required"}]},{default:x(()=>[y(s,{modelValue:r.title,"onUpdate:modelValue":a[0]||(a[0]=I=>r.title=I),placeholder:"Enter transmittal title","max-length":500,"show-word-limit":""},null,8,["modelValue"])]),_:1}),y(g,{field:"message",label:"Message (Optional)"},{default:x(()=>[y(u,{modelValue:r.message,"onUpdate:modelValue":a[1]||(a[1]=I=>r.message=I),placeholder:"Enter a message for the recipients...","max-length":2e3,"auto-size":{minRows:3,maxRows:6},"show-word-limit":""},null,8,["modelValue"])]),_:1}),y(g,{field:"recipients",label:"Recipients",rules:[{required:!0,message:"At least one recipient is required",validator:A}]},{default:x(()=>[y(re,{modelValue:r.recipients,"onUpdate:modelValue":a[2]||(a[2]=I=>r.recipients=I)},null,8,["modelValue"])]),_:1},8,["rules"]),y(g,{field:"files",label:"Files",rules:[{required:!0,message:"At least one file is required",validator:z}]},{default:x(()=>[y(tt,{modelValue:r.files,"onUpdate:modelValue":a[3]||(a[3]=I=>r.files=I),"project-id":E(k)},null,8,["modelValue","project-id"])]),_:1},8,["rules"])]),_:1},8,["model"])]),_:1},8,["visible"])}}},st=R(lt,[["__scopeId","data-v-24620724"]]),nt={__name:"UserAvatar",props:{name:{type:String,required:!0},email:{type:String,default:""},size:{type:Number,default:32}},setup(l){const _=l,i=F(()=>{if(!_.name)return"?";const h=_.name.trim().split(/\s+/);return h.length===1?h[0].substring(0,2).toUpperCase():(h[0][0]+h[h.length-1][0]).toUpperCase()}),w=F(()=>Math.floor(_.size*.4)),v=F(()=>_.email?`${_.name} (${_.email})`:_.name);return(h,m)=>{const k=T("a-tooltip");return d(),M(k,{content:v.value},{default:x(()=>[n("div",{class:"user-avatar",style:B({width:l.size+"px",height:l.size+"px",fontSize:w.value+"px"})},C(i.value),5)]),_:1},8,["content"])}}},H=R(nt,[["__scopeId","data-v-b08d91e1"]]),at={class:"flex justify-between items-center mb-4"},rt={key:1,class:"text-text-disabled"},ot={class:"flex items-center gap-2"},it={class:"text-sm"},dt={class:"flex items-center gap-1 flex-wrap"},ut={key:1,class:"text-text-disabled text-sm"},ct={__name:"TransmittalTable",props:{transmittals:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},currentUser:{type:Object,default:()=>({userId:"",autodeskId:"",name:"",email:""})}},emits:["row-click","created"],setup(l,{emit:_}){const i=_,w=S(!1),v=[{title:"Transmittal ID",dataIndex:"display_index",slotName:"transmittal_id",width:120,sortable:{sortDirections:["ascend","descend"]}},{title:"Title",dataIndex:"subject",ellipsis:!0,tooltip:!0},{title:"Status",dataIndex:"status",slotName:"status",width:120},{title:"Creator",dataIndex:"created_by_name",slotName:"creator",width:200},{title:"Recipients",dataIndex:"recipients",slotName:"recipients",width:300},{title:"Documents",dataIndex:"document_count",slotName:"documents",width:100,align:"center"},{title:"Created At",dataIndex:"created_at",slotName:"created_at",width:180}],h=F(()=>({showTotal:!0,showPageSize:!0,pageSizeOptions:[10,20,50,100]}));function m(r){i("row-click",r)}function k(r){i("created",r)}return(r,b)=>{const A=T("a-button"),z=T("a-table");return d(),p("div",null,[n("div",at,[te(r.$slots,"header",{},void 0,!0),y(A,{type:"primary",onClick:b[0]||(b[0]=o=>w.value=!0)},{icon:x(()=>[y(E(le))]),default:x(()=>[b[2]||(b[2]=$(" Create Transmittal ",-1))]),_:1})]),y(z,{columns:v,data:l.transmittals,loading:l.loading,pagination:h.value,"row-key":"id",hoverable:!0,onRowClick:m},{transmittal_id:x(({record:o})=>[$(C(o.display_index),1)]),status:x(({record:o})=>[o.status?(d(),p("span",{key:0,class:j(`status-tag status-${o.status.toLowerCase()}`)},C(o.status),3)):(d(),p("span",rt,"-"))]),creator:x(({record:o})=>[n("div",ot,[y(H,{name:o.created_by_name||o.created_by_user_name||"Unknown",email:o.created_by_email||"",size:28},null,8,["name","email"]),n("span",it,C(o.created_by_name||o.created_by_user_name||"Unknown"),1)])]),recipients:x(({record:o})=>[n("div",dt,[o.recipients&&o.recipients.length>0?(d(!0),p(N,{key:0},D(o.recipients,(f,c)=>(d(),M(H,{key:c,name:f.name||f.email,email:f.email,size:28},null,8,["name","email"]))),128)):(d(),p("span",ut,"-"))])]),documents:x(({record:o})=>[$(C(o.document_count||0),1)]),created_at:x(({record:o})=>[$(C(E(ue)(o.created_at)),1)]),_:1},8,["data","loading","pagination"]),y(st,{modelValue:w.value,"onUpdate:modelValue":b[1]||(b[1]=o=>w.value=o),"current-user":l.currentUser,onCreated:k},null,8,["modelValue","current-user"])])}}},mt=R(ct,[["__scopeId","data-v-6fbc60ed"]]),ft={class:"page-container"},pt={class:"page-header"},vt={class:"flex gap-3 items-center"},gt={class:"filters-bar"},_t={class:"card"},ht={__name:"TransmittalList",setup(l){const _=se(),i=S(""),w=S({userId:"",autodeskId:"",name:"",email:""}),v=S([]),h=S(!1),m=W({searchTerm:"",status:void 0}),k=F(()=>{let c=v.value;if(m.searchTerm){const t=m.searchTerm.toLowerCase();c=c.filter(a=>{var e,s;return((e=a.transmittal_number)==null?void 0:e.toLowerCase().includes(t))||((s=a.subject)==null?void 0:s.toLowerCase().includes(t))})}return m.status&&(c=c.filter(t=>t.status===m.status)),c});function r(c){w.value=c,f()}function b(){}function A(){}async function z(){await f()}function o(c){_.push({name:"TransmittalDetail",params:{id:c.id}})}async function f(){h.value=!0;try{const c=await me();if(c.success&&c.data){const t=c.data.sort((a,e)=>new Date(a.created_at)-new Date(e.created_at));v.value=t.map((a,e)=>({...a,display_index:e+1})),console.log("[TransmittalList] Loaded and sorted transmittals:",v.value.length),await Promise.all(v.value.map(async a=>{try{console.log(`[TransmittalList] Loading recipients for transmittal ${a.id}...`);const e=await fe(a.id);if(console.log(`[TransmittalList] Recipients response for ${a.id}:`,e),e.success&&e.data){const s=Array.isArray(e.data)?e.data:[];a.recipients=s,console.log(`[TransmittalList] Set ${s.length} recipients for transmittal ${a.id}`)}else a.recipients=[],console.log(`[TransmittalList] No recipients data for transmittal ${a.id}`)}catch(e){console.error(`Failed to load recipients for transmittal ${a.id}:`,e),a.recipients=[]}})),console.log("[TransmittalList] Final transmittals with recipients:",v.value)}else L.error("Failed to load transmittals")}catch(c){console.error("Failed to load transmittals:",c),L.error(c.message||"Failed to load transmittals")}finally{h.value=!1}}return O(()=>{f()}),(c,t)=>{const a=T("a-input-search"),e=T("a-option"),s=T("a-select"),g=T("a-button");return d(),p("div",ft,[n("div",pt,[t[3]||(t[3]=n("div",null,[n("h1",{class:"page-title"},"Transmittals"),n("p",{class:"text-text-secondary text-sm mt-1"}," Manage and track document transmittals ")],-1)),n("div",vt,[y(ce,{modelValue:i.value,"onUpdate:modelValue":t[0]||(t[0]=u=>i.value=u),onUserChanged:r},null,8,["modelValue"])])]),n("div",gt,[y(a,{modelValue:m.searchTerm,"onUpdate:modelValue":t[1]||(t[1]=u=>m.searchTerm=u),placeholder:"Search transmittals...",class:"w-64",onSearch:b},null,8,["modelValue"]),y(s,{modelValue:m.status,"onUpdate:modelValue":t[2]||(t[2]=u=>m.status=u),placeholder:"Status",class:"w-40","allow-clear":"",onChange:A},{default:x(()=>[y(e,{value:"DRAFT"},{default:x(()=>[...t[4]||(t[4]=[$("Draft",-1)])]),_:1}),y(e,{value:"SENT"},{default:x(()=>[...t[5]||(t[5]=[$("Sent",-1)])]),_:1}),y(e,{value:"COMPLETED"},{default:x(()=>[...t[6]||(t[6]=[$("Completed",-1)])]),_:1}),y(e,{value:"CANCELLED"},{default:x(()=>[...t[7]||(t[7]=[$("Cancelled",-1)])]),_:1})]),_:1},8,["modelValue"]),y(g,{onClick:z},{icon:x(()=>[y(E(_e))]),default:x(()=>[t[8]||(t[8]=$(" Refresh ",-1))]),_:1})]),n("div",_t,[y(mt,{transmittals:k.value,loading:h.value,"current-user":w.value,onRowClick:o},null,8,["transmittals","loading","current-user"])])])}}},bt=R(ht,[["__scopeId","data-v-a56f20df"]]);export{bt as default};
